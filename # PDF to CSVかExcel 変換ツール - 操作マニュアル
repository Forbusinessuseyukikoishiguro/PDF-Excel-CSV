# PDF to CSV/Excel 変換ツール - 操作マニュアル

## 🎯 ツールの概要
ExcelファイルのPDFやテーブル形式のPDFを、CSVファイルまたはExcelファイルに変換するGUIツールです。

## 🚀 起動方法
```powershell
# 仮想環境を有効化してから実行
(venv) PS C:\Users\yukik\Desktop\excel> python pdf_converter.py
```

---

## 📖 基本操作ガイド

### 1. ファイル選択
**変換元PDFファイル**
- 「参照」ボタンをクリック
- 変換したいPDFファイルを選択
- 対応形式: `.pdf`

**出力フォルダ**
- 「参照」ボタンをクリック
- 変換後のファイルを保存するフォルダを選択
- デフォルト: 現在の作業フォルダ

### 2. 変換形式の選択
- **CSV**: カンマ区切りファイル（文字コード: UTF-8 BOM付き）
- **Excel**: Microsoft Excel形式（.xlsx）

### 3. オプション設定
**元ファイルのバックアップを作成**
- チェック: 元PDFのバックアップを`backup`フォルダに作成
- バックアップファイル名: `元ファイル名_backup_YYYYMMDD_HHMMSS.pdf`

**ファイル名にタイムスタンプを追加**
- チェック: 出力ファイル名に日時を追加
- 形式: `ファイル名_YYYYMMDD_HHMMSS.csv(xlsx)`

### 4. PDF読み取り設定
**開始ページ**
- 空白: 全ページを処理
- 数値入力: 指定ページから開始

**終了ページ**
- 空白: 最後のページまで処理
- 数値入力: 指定ページで終了

### 5. 変換実行
- **変換実行**ボタンをクリック
- プログレスバーで進行状況を確認
- ログエリアで詳細な処理状況を確認

---

## ✨ できること

### 📊 テーブル抽出機能
1. **構造化テーブルの自動検出**
   - PDFから表形式データを自動認識
   - 複数テーブルの同時処理

2. **テキストベース抽出**
   - テーブルが見つからない場合、テキストを解析
   - スペース・タブ区切りデータを表形式に変換

3. **複数ページ対応**
   - 指定範囲のページを一括処理
   - ページごとのテーブルを個別に管理

### 💾 出力機能
**CSV出力**
- 単一テーブル: `ファイル名.csv`
- 複数テーブル: `ファイル名_Page_X_Table_Y.csv`

**Excel出力**
- 複数テーブルを個別シートとして保存
- シート名: `Page_X_Table_Y` または `Page_X_Text`

### 🛡️ 安全機能
- 自動バックアップ作成
- エラーハンドリング
- 詳細ログ出力
- 処理中断機能（プログレスバー停止）

---

## 📋 技術仕様

### 対応ファイル形式
| 項目 | 仕様 |
|------|------|
| 入力形式 | PDF (.pdf) |
| 出力形式 | CSV (.csv), Excel (.xlsx) |
| 文字エンコード | UTF-8 BOM付き |
| 最大ページ数 | 制限なし |

### システム要件
| 項目 | 仕様 |
|------|------|
| OS | Windows 10/11 |
| Python | 3.7以上 |
| メモリ | 最低2GB（大きなPDFには4GB推奨） |
| ディスク容量 | 元ファイルの2倍以上の空き容量 |

### データ処理仕様
| 機能 | 詳細 |
|------|------|
| テーブル検出 | pdfplumberライブラリ使用 |
| データ処理 | pandasライブラリ使用 |
| 文字認識 | 埋め込みテキスト抽出（OCRなし） |
| 列の自動調整 | 最大列数に合わせて空白セル補完 |

---

## 🔧 使用例

### 例1: 単純なテーブル変換
1. 販売レポートのPDFを選択
2. CSV形式を選択
3. 変換実行
4. `販売レポート_20250106_143022.csv`として出力

### 例2: 複数ページの一括変換
1. 財務諸表（3ページ）のPDFを選択
2. 開始ページ: 1、終了ページ: 3
3. Excel形式を選択
4. 各ページのテーブルが個別シートとして保存

### 例3: 特定ページのみ抽出
1. 100ページの報告書から5-10ページのみ変換
2. 開始ページ: 5、終了ページ: 10
3. バックアップ作成をチェック
4. 指定範囲のみ処理され、元ファイルもバックアップ

---

## ⚠️ 制限事項

### 対応できないPDF
- スキャンされた画像PDF（OCR機能なし）
- パスワード保護されたPDF
- 極度に複雑なレイアウト
- 縦書きテキスト

### パフォーマンス
- 大きなPDFファイル（100MB以上）は処理時間が長くなる
- 複雑なテーブルは抽出精度が下がる場合がある
- FontBBox警告は表示されるが動作に影響なし

### ファイル名制限
- Windowsの文字制限に準拠
- シート名は31文字以内に自動調整

---

## 🆘 トラブルシューティング

### よくある問題

**1. テーブルが抽出されない**
- 解決策: PDFが画像形式でないか確認
- 代替案: テキスト抽出モードで処理

**2. 文字化けが発生**
- 解決策: 出力ファイルをUTF-8対応エディタで開く
- Excel: データタブ→テキストファイル→UTF-8を選択

**3. メモリエラー**
- 解決策: 小さなページ範囲に分割して処理
- 大きなPDFは10-20ページずつ処理推奨

**4. 処理が遅い**
- 原因: 複雑なPDFレイアウト
- 対策: ページ範囲を狭めて処理

---

## 📞 サポート情報

### ログの確認方法
GUI下部のログエリアで処理状況を確認できます。エラーが発生した場合、ログ内容をコピーして保存してAIで調査してください。

### バックアップファイルの場所
元PDFファイルと同じフォルダ内の`backup`サブフォルダに自動作成されます。
